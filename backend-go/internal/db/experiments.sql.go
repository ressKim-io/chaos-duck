// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: experiments.sql

package db

import (
	"context"
	"encoding/json"

	"github.com/jackc/pgx/v5/pgtype"
)

const createExperiment = `-- name: CreateExperiment :one
INSERT INTO experiments (id, config, status, phase, started_at)
VALUES ($1, $2, $3, $4, $5)
RETURNING id, config, status, phase, started_at, completed_at, steady_state, hypothesis, injection_result, observations, rollback_result, error, ai_insights
`

type CreateExperimentParams struct {
	ID        string             `json:"id"`
	Config    json.RawMessage    `json:"config"`
	Status    string             `json:"status"`
	Phase     string             `json:"phase"`
	StartedAt pgtype.Timestamptz `json:"started_at"`
}

func (q *Queries) CreateExperiment(ctx context.Context, arg CreateExperimentParams) (Experiment, error) {
	row := q.db.QueryRow(ctx, createExperiment,
		arg.ID,
		arg.Config,
		arg.Status,
		arg.Phase,
		arg.StartedAt,
	)
	var i Experiment
	err := row.Scan(
		&i.ID,
		&i.Config,
		&i.Status,
		&i.Phase,
		&i.StartedAt,
		&i.CompletedAt,
		&i.SteadyState,
		&i.Hypothesis,
		&i.InjectionResult,
		&i.Observations,
		&i.RollbackResult,
		&i.Error,
		&i.AiInsights,
	)
	return i, err
}

const getExperiment = `-- name: GetExperiment :one
SELECT id, config, status, phase, started_at, completed_at, steady_state, hypothesis, injection_result, observations, rollback_result, error, ai_insights FROM experiments WHERE id = $1
`

func (q *Queries) GetExperiment(ctx context.Context, id string) (Experiment, error) {
	row := q.db.QueryRow(ctx, getExperiment, id)
	var i Experiment
	err := row.Scan(
		&i.ID,
		&i.Config,
		&i.Status,
		&i.Phase,
		&i.StartedAt,
		&i.CompletedAt,
		&i.SteadyState,
		&i.Hypothesis,
		&i.InjectionResult,
		&i.Observations,
		&i.RollbackResult,
		&i.Error,
		&i.AiInsights,
	)
	return i, err
}

const listExperiments = `-- name: ListExperiments :many
SELECT id, config, status, phase, started_at, completed_at, steady_state, hypothesis, injection_result, observations, rollback_result, error, ai_insights FROM experiments ORDER BY started_at DESC
`

func (q *Queries) ListExperiments(ctx context.Context) ([]Experiment, error) {
	rows, err := q.db.Query(ctx, listExperiments)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Experiment{}
	for rows.Next() {
		var i Experiment
		if err := rows.Scan(
			&i.ID,
			&i.Config,
			&i.Status,
			&i.Phase,
			&i.StartedAt,
			&i.CompletedAt,
			&i.SteadyState,
			&i.Hypothesis,
			&i.InjectionResult,
			&i.Observations,
			&i.RollbackResult,
			&i.Error,
			&i.AiInsights,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateExperiment = `-- name: UpdateExperiment :exec
UPDATE experiments
SET status = $2,
    phase = $3,
    completed_at = $4,
    steady_state = $5,
    hypothesis = $6,
    injection_result = $7,
    observations = $8,
    rollback_result = $9,
    error = $10,
    ai_insights = $11
WHERE id = $1
`

type UpdateExperimentParams struct {
	ID              string             `json:"id"`
	Status          string             `json:"status"`
	Phase           string             `json:"phase"`
	CompletedAt     pgtype.Timestamptz `json:"completed_at"`
	SteadyState     []byte             `json:"steady_state"`
	Hypothesis      pgtype.Text        `json:"hypothesis"`
	InjectionResult []byte             `json:"injection_result"`
	Observations    []byte             `json:"observations"`
	RollbackResult  []byte             `json:"rollback_result"`
	Error           pgtype.Text        `json:"error"`
	AiInsights      []byte             `json:"ai_insights"`
}

func (q *Queries) UpdateExperiment(ctx context.Context, arg UpdateExperimentParams) error {
	_, err := q.db.Exec(ctx, updateExperiment,
		arg.ID,
		arg.Status,
		arg.Phase,
		arg.CompletedAt,
		arg.SteadyState,
		arg.Hypothesis,
		arg.InjectionResult,
		arg.Observations,
		arg.RollbackResult,
		arg.Error,
		arg.AiInsights,
	)
	return err
}

const updateExperimentStatus = `-- name: UpdateExperimentStatus :exec
UPDATE experiments SET status = $2 WHERE id = $1
`

type UpdateExperimentStatusParams struct {
	ID     string `json:"id"`
	Status string `json:"status"`
}

func (q *Queries) UpdateExperimentStatus(ctx context.Context, arg UpdateExperimentStatusParams) error {
	_, err := q.db.Exec(ctx, updateExperimentStatus, arg.ID, arg.Status)
	return err
}
